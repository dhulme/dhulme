<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300&display=swap"
    rel="stylesheet"
    />
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      html, body {
        font-family: 'Roboto', sans-serif;
        font-weight: 100;
        margin: 0;
        padding: 0;
      }
      main {
        height: 100vh;
        padding: 1rem;
      }
      main.dark {
        background: black;
        color: white;
      }
      button,
      input {
        font-family: 'Roboto', sans-serif;
        font-weight: 400;
        margin-bottom: 1rem;
      }
      button {
        padding: 0.5rem;
      }
      ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        overflow: hidden;
        margin-bottom: 1rem;
        font-size: 4rem;
      }
      ul li {
        margin-bottom: 0.5rem;
      }
    </style>
  </head>
  <body>
    <main x-data="main":class="darkTheme && 'dark'" x-init="init">
      <ul>
        <template x-for="name in shuffledNames">
          <li x-text="name"></li>
        </template>
      </ul>
      <form @submit="inputSubmit">
      <input
        type="text"
        x-model="ignoredNamesString"
        placeholder="Ignore these people"
        x-effect="ignore" 
      />
      </form>
      <button class="button" @click="shuffle">Refresh</button>
      <button @click="toggleTheme">Toggle theme</button>
    </main>
    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.data('main', () => ({
          names: ['DHU', 'AKJ', 'CBF', 'SEG', 'SPS', 'MSA', 'NCM'],
          ignoredNamesString: localStorage.getItem('ignore') || '',
          filteredNames: [],
          shuffledNames: [],
          darkTheme: localStorage.getItem('darkTheme') === 'true',
          inputSubmit(event) {
            event.preventDefault();
            this.ignore();
            this.shuffle();
          },
          ignore() {
            const ignoredNames = this.ignoredNamesString.toUpperCase().split(',').map(name => name.trim());
            this.filteredNames = _.difference(this.names, ignoredNames);
            localStorage.setItem('ignore', this.ignoredNamesString);
          },
          shuffle() {
            this.shuffledNames = _.shuffle(this.filteredNames);
          },
          toggleTheme() {
            this.darkTheme = !this.darkTheme;
            localStorage.setItem('darkTheme', this.darkTheme);
          },
          init() {
            this.ignore();
            this.shuffle();
          },
        }));
      });
    </script>
  </body>
</html>
